/*! waveform-data - v1.3.0 - 2014-06-07
* https://github.com/bbcrd/waveform-data.js
* Copyright (c) 2014 ; Licensed LGPL-3.0 */
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.WaveformData=a():"undefined"!=typeof global?global.WaveformData=a():"undefined"!=typeof self&&(self.WaveformData=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=b.exports=function(a){this.data=a};c.isCompatible=function(a){return a&&"object"==typeof a&&"byteLength"in a},c.fromResponseData=function(a){return new c(new DataView(a))},c.prototype={get version(){return this.data.getInt32(0,!0)},get is_8_bit(){return!!this.data.getUint32(4,!0)},get is_16_bit(){return!this.is_8_bit},get sample_rate(){return this.data.getInt32(8,!0)},get scale(){return this.data.getInt32(12,!0)},get length(){return this.data.getUint32(16,!0)},at:function(a){return Math.round(this.data.getInt8(20+a))}}},{}],2:[function(a,b){"use strict";b.exports={arraybuffer:a("./arraybuffer.js"),object:a("./object.js")}},{"./arraybuffer.js":1,"./object.js":3}],3:[function(a,b){"use strict";var c=b.exports=function(a){this.data=a};c.isCompatible=function(a){return a&&"object"==typeof a&&"sample_rate"in a||"string"==typeof a&&"sample_rate"in JSON.parse(a)},c.fromResponseData=function(a){return new c("string"==typeof a?JSON.parse(a):a)},c.prototype={get version(){return this.data.version||1},get is_8_bit(){return 8===this.data.bits},get is_16_bit(){return!this.is_8_bit},get sample_rate(){return this.data.sample_rate},get scale(){return this.data.samples_per_pixel},get length(){return this.data.length},at:function(a){return Math.round(this.data.data[a])}}},{}],4:[function(a,b){"use strict";function c(a,b){var e=c.getAudioContext(),f=512,g=127;e.decodeAudioData(a,function(a){var c,e,h=Math.floor(a.length/f),i=20,j=new DataView(new ArrayBuffer(i+2*h)),k=1/0,l=-1/0,m=f,n=a.length;j.setInt32(0,1,!0),j.setUint32(4,1,!0),j.setInt32(8,a.sampleRate,!0),j.setInt32(12,f,!0),j.setInt32(16,h,!0),c=a.getChannelData(0),e=a.getChannelData(0);for(var o=0;n>o;o++){var p=(c[o]+e[o])/2*g;k>p&&(k=p),p>l&&(l=p),0===--m&&(j.setInt8(i++,Math.floor(k)),j.setInt8(i++,Math.floor(l)),k=1/0,l=-1/0,m=f)}b(new d(j.buffer,d.adapters.arraybuffer))})}var d=a("../core.js");d.adapters=a("../adapters"),c.getAudioContext=function(){var a=window.AudioContext||window.webkitAudioContext;return new a},b.exports=c},{"../adapters":2,"../core.js":5}],5:[function(a,b){"use strict";var c=a("./segment.js"),d=a("./point.js"),e=b.exports=function(a,b){this.adapter=b.fromResponseData(a),this.segments={},this.points={},this.offset(0,this.adapter.length)};e.create=function(a){var b=null,c=null;if(a&&"object"==typeof a&&("responseText"in a||"response"in a)&&(c="responseType"in a?a.response:a.responseText||a.response),Object.keys(e.adapters).some(function(d){return e.adapters[d].isCompatible(c||a)?(b=e.adapters[d],!0):void 0}),null===b)throw new TypeError("Could not detect a WaveformData adapter from the input.");return new e(c||a,b)},e.prototype={offset:function(a,b){var c=this.adapter.length;if(0>b)throw new RangeError("End point must be non-negative.");if(a>=b)throw new RangeError("We can't end prior to the starting point.");if(0>a)throw new RangeError("Start point must be non-negative.");if(a>=c)throw new RangeError("Start point must be within range.");b>c&&(b=c),this.offset_start=a,this.offset_end=b,this.offset_length=b-a},set_segment:function(a,b,d){return d=d||"default",this.segments[d]=new c(this,a,b),this.segments[d]},set_point:function(a,b){return b=b||"default",this.points[b]=new d(this,a),this.points[b]},remove_point:function(a){this.points[a]&&delete this.points[a]},resample:function(a){"number"==typeof a&&(a={width:a});var b=[],c=a.scale||Math.floor(this.duration*this.adapter.sample_rate/a.width),d=this.adapter.scale,f=this.adapter.length,g=f?this.min_sample(0):0,h=f?this.max_sample(0):0,i=0,j=0,k=-128,l=127;if(d>c)throw new Error("Zoom level "+c+" too low, minimum: "+d);for(var m,n,o,p,q,r=function(a){return Math.floor(a*c)},s=function(a,c){b.push(a,c)};f>i;){for(;Math.floor(r(j)/d)===i;)j&&s(g,h),q=i,j++,m=r(j),n=r(j-1),m!==n&&(g=l,h=k);for(m=r(j),o=Math.floor(m/d),o>f&&(o=f);o>i;)p=this.min_sample(i),g>p&&(g=p),p=this.max_sample(i),p>h&&(h=p),i++}return i!==q&&s(g,h),new e({version:this.adapter.version,samples_per_pixel:c,length:b.length/2,data:b,sample_rate:this.adapter.sample_rate},e.adapters.object)},get min(){return this.offsetValues(this.offset_start,this.offset_length,0)},get max(){return this.offsetValues(this.offset_start,this.offset_length,1)},offsetValues:function(a,b,c){var d=this.adapter,e=[];c+=2*a;for(var f=0;b>f;f++)e.push(d.at(2*f+c));return e},get duration(){return this.adapter.length*this.adapter.scale/this.adapter.sample_rate},get offset_duration(){return this.offset_length*this.adapter.scale/this.adapter.sample_rate},get pixels_per_second(){return this.adapter.sample_rate/this.adapter.scale},get seconds_per_pixel(){return this.adapter.scale/this.adapter.sample_rate},at:function(a){return this.adapter.at(a)},at_time:function(a){return Math.floor(a*this.adapter.sample_rate/this.adapter.scale)},time:function(a){return a*this.seconds_per_pixel},in_offset:function(a){return a>=this.offset_start&&a<this.offset_end},min_sample:function(a){return this.adapter.at(2*a)},max_sample:function(a){return this.adapter.at(2*a+1)}},e.adapters={},e.adapter=function(a){this.data=a}},{"./point.js":6,"./segment.js":7}],6:[function(a,b){"use strict";var c=b.exports=function(a,b){this.context=a,this.timeStamp=b};c.prototype={get visible(){return this.context.in_offset(this.timeStamp)}}},{}],7:[function(a,b){"use strict";var c=b.exports=function(a,b,c){this.context=a,this.start=b,this.end=c};c.prototype={get offset_start(){return this.start<this.context.offset_start&&this.end>this.context.offset_start?this.context.offset_start:this.start>=this.context.offset_start&&this.start<this.context.offset_end?this.start:null},get offset_end(){return this.end>this.context.offset_start&&this.end<=this.context.offset_end?this.end:this.end>this.context.offset_end&&this.start<this.context.offset_end?this.context.offset_end:null},get offset_length(){return this.offset_end-this.offset_start},get length(){return this.end-this.start},get visible(){return this.context.in_offset(this.start)||this.context.in_offset(this.end)||this.context.offset_start>this.start&&this.context.offset_start<this.end},get min(){return this.visible?this.context.offsetValues(this.offset_start,this.offset_length,0):[]},get max(){return this.visible?this.context.offsetValues(this.offset_start,this.offset_length,1):[]}}},{}],8:[function(a,b){"use strict";var c=a("./lib/core");c.adapters=a("./lib/adapters"),c.builders={webaudio:a("./lib/builders/webaudio.js")},b.exports=c},{"./lib/adapters":2,"./lib/builders/webaudio.js":4,"./lib/core":5}]},{},[8])(8)});